---
- name: Install RHCS dependencies
  hosts: all
  become: yes
  tasks:
    - name: Install RPMs
      yum:
        name: "{{ item }}"
        state: latest
      with_items:
        - pcs
        - pacemaker
        - fence-agents-all
    - name: Open firewall ports
      firewalld:
        service: high-availability
        permanent: true
        state: enabled
    - name: Set hacluster passwd
      shell: echo {{ foreman_params.hacluster_passwd }} | passwd --stdin hacluster
    - name: Start pcsd
      service:
        name: pcsd
        enabled: yes
        state: started
    - name: Authenticate pcs
      shell: pcs cluster auth {{ foreman_params.cluster_peers }} -u hacluster -p {{ foreman_params.hacluster_passwd | join(' ') }}


